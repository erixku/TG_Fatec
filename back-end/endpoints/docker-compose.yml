# Versão da sintaxe do Docker Compose. '3.8' é uma boa versão recente.
version: '3.8'

# Define os serviços (contêineres) da sua aplicação
services:
  # Serviço para a sua API Spring Boot
  app:
    # Constrói a imagem Docker a partir do Dockerfile no diretório atual
    # Certifique-se de que o Dockerfile está na raiz do seu projeto
    build:
      context: . # O contexto do build é o diretório atual
      dockerfile: Dockerfile # O nome do seu Dockerfile
    
    # Mapeia portas do host para o contêiner
    # Esquerda: porta no seu computador local
    # Direita: porta que o contêiner expõe (definida no EXPOSE do Dockerfile, geralmente 8080)
    ports:
      - "8080:8080"
    
    # Monta um volume para o código-fonte
    # Isso permite que você faça alterações no código no seu host e veja as atualizações
    # no contêiner sem precisar reconstruir a imagem (útil com Spring Boot DevTools ou Hot Reload)
    # Cuidado: Para produção, é mais comum copiar o JAR, não montar o código-fonte.
    volumes:
      - .:/app # Monta o diretório atual do host para /app dentro do contêiner
      - /app/target # Evita que a pasta 'target' (com o JAR) no contêiner sobrescreva a do host
    
  # Serviço para o banco de dados PostgreSQL
  db:
    # Usa a imagem oficial do PostgreSQL do Docker Hub
    image: postgres:16-alpine # 16 é a versão, -alpine é uma imagem leve
    
    # Monta um volume para persistir os dados do banco de dados
    # Isso garante que seus dados não sejam perdidos se o contêiner do DB for removido
    volumes:
      - db_data:/var/lib/postgresql/data # Mapeia um volume nomeado para a pasta de dados do PostgreSQL

# Define os volumes nomeados usados pelos serviços
volumes:
  db_data: # Onde os dados do PostgreSQL serão armazenados de forma persistente